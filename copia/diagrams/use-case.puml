@startuml UseCaseDiagram
!theme plain
title Diagrama de Casos de Uso - Sistema de Gestão Financeira

' Configurações profissionais otimizadas
skinparam defaultFontColor #000000
skinparam backgroundColor white
skinparam shadowing false
skinparam roundcorner 8
skinparam linetype ortho
skinparam nodesep 60
skinparam ranksep 80

skinparam usecase {
    BorderColor #2C3E50
    BackgroundColor #F8F9FA
    FontSize 11
    FontStyle bold
    BorderThickness 2
}
skinparam actor {
    BorderColor #34495E
    BackgroundColor #E8F4FD
    FontSize 12
    FontStyle bold
    BorderThickness 2
}
skinparam rectangle {
    BorderColor #2C3E50
    BackgroundColor #ECF0F1
    FontStyle bold
    BorderThickness 2
}
skinparam package {
    BorderColor #7F8C8D
    BackgroundColor #FAFBFC
    FontSize 11
    FontStyle bold
    BorderThickness 1
}
skinparam arrow {
    Color #34495E
    FontColor #000000
    FontSize 10
    Thickness 2
}

' Layout otimizado
top to bottom direction

' Atores do sistema (posicionamento estratégico)
actor "**USUÁRIO**\n**FINAL**" as User #E3F2FD
actor "**ADMINISTRADOR**\n**SISTEMA**" as Admin #FFEBEE
actor "**GATEWAY**\n**PAGAMENTO**" as PaymentGW #E8F5E8
actor "**SERVIÇO**\n**EMAIL**" as EmailService #FFF8E1

rectangle "**SISTEMA DE GESTÃO FINANCEIRA EMPRESARIAL**" {
    
    package "**MÓDULO: AUTENTICAÇÃO & USUÁRIOS**" #E3F2FD {
        usecase "**UC01**\n\nRegistrar\nNova Conta" as UC01
        usecase "**UC02**\n\nAutenticar\nUsuário (JWT)" as UC02
        usecase "**UC03**\n\nRecuperar\nSenha" as UC03
        usecase "**UC04**\n\nGerenciar\nPerfil" as UC04
    }
    
    package "**MÓDULO: GESTÃO EMPRESARIAL**" #E8F5E8 {
        usecase "**UC05**\n\nCadastrar\nEmpresa" as UC05
        usecase "**UC06**\n\nDefinir Empresa\nPadrão" as UC06
        usecase "**UC07**\n\nValidar\nDados Empresa" as UC07
    }
    
    package "**MÓDULO: TRANSAÇÕES FINANCEIRAS**" #FFF3E0 {
        usecase "**UC08**\n\nCriar\nTransação" as UC08
        usecase "**UC09**\n\nCategorizar\nTransação" as UC09
        usecase "**UC10**\n\nValidar Limites\ndo Plano" as UC10
        usecase "**UC11**\n\nGerar\nRelatórios" as UC11
    }
    
    package "**MÓDULO: ASSINATURAS & PAGAMENTOS**" #F3E5F5 {
        usecase "**UC12**\n\nVisualizar\nPlanos" as UC12
        usecase "**UC13**\n\nUpgrade\nde Plano" as UC13
        usecase "**UC14**\n\nProcessar\nPagamento" as UC14
        usecase "**UC15**\n\nValidar\nAssinatura" as UC15
    }
    
    package "**MÓDULO: PROCESSAMENTO FISCAL**" #E8F8F5 {
        usecase "**UC16**\n\nUpload\nNota Fiscal" as UC16
        usecase "**UC17**\n\nExtrair Dados\nNF-e" as UC17
        usecase "**UC18**\n\nCriar\nFornecedor" as UC18
        usecase "**UC19**\n\nIntegrar\nTransação" as UC19
    }
    
    package "**MÓDULO: ADMINISTRAÇÃO**" #FFEBEE {
        usecase "**UC20**\n\nGerenciar\nUsuários" as UC20
        usecase "**UC21**\n\nMonitorar\nSistema" as UC21
        usecase "**UC22**\n\nConfigurar\nPlanos" as UC22
    }
}

' Posicionamento hierárquico dos atores
User -[hidden]down- Admin
Admin -[hidden]down- PaymentGW
PaymentGW -[hidden]down- EmailService

' Relacionamentos do Usuário Final
User -down-> UC01 : **registra**
User -down-> UC02 : **autentica**
User -down-> UC03 : **solicita**
User -down-> UC04 : **gerencia**
User -down-> UC05 : **cadastra**
User -down-> UC06 : **define**
User -down-> UC08 : **cria**
User -down-> UC09 : **categoriza**
User -down-> UC11 : **solicita**
User -down-> UC12 : **visualiza**
User -down-> UC13 : **solicita**
User -down-> UC16 : **faz upload**
User -down-> UC18 : **visualiza**

' Relacionamentos do Administrador
Admin -down-> UC20 : **administra**
Admin -down-> UC21 : **monitora**
Admin -down-> UC22 : **configura**
Admin -down-> UC07 : **valida**
Admin -down-> UC15 : **verifica**
Admin -down-> UC17 : **monitora**

' Relacionamentos Sistemas Externos
PaymentGW -down-> UC14 : **processa**
EmailService -down-> UC03 : **envia**

' Dependências e Extensões (pontilhadas)
UC02 .up.> UC01 : **<<extend>>**\n(se não cadastrado)
UC08 .right.> UC10 : **<<include>>**\n(sempre verificar)
UC13 .down.> UC14 : **<<include>>**\n(processar pagto)
UC05 .right.> UC07 : **<<include>>**\n(validar dados)
UC09 .up.> UC08 : **<<extend>>**\n(opcional)
UC16 .right.> UC17 : **<<include>>**\n(sempre extrair)
UC17 .down.> UC18 : **<<extend>>**\n(se não existe)
UC17 .right.> UC19 : **<<include>>**\n(sempre integrar)

' Notas explicativas estratégicas
note top of UC10 : **REGRA CRÍTICA**\nVerificar limites antes\nde criar transação

note right of UC14 : **INTEGRAÇÃO**\nWebhook confirma\npagamento processado

note left of UC02 : **SEGURANÇA**\nJWT tokens com\nrefresh automático

note right of UC17 : **PROCESSAMENTO**\nOCR para PDF\nXML parser para NF-e

@enduml
